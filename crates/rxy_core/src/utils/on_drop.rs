use core::mem::ManuallyDrop;

pub struct OnDrop<F: FnOnce()> {
   callback: ManuallyDrop<F>,
}

impl<F: FnOnce()> OnDrop<F> {
   /// Returns an object that will invoke the specified callback when dropped.
   #[allow(dead_code)]
   pub fn new(callback: F) -> Self {
      Self {
         callback: ManuallyDrop::new(callback),
      }
   }
}

impl<F: FnOnce()> Drop for OnDrop<F> {
   fn drop(&mut self) {
      // SAFETY: We may move out of `self`, since this instance can never be observed after it's dropped.
      let callback = unsafe { ManuallyDrop::take(&mut self.callback) };
      callback();
   }
}
